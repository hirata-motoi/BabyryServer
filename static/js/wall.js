// Generated by CoffeeScript 1.6.3
(function() {
  var console, count, page;

  if (typeof window.console === "undefined") {
    console = {};
    console.log = console.warn = console.error = function(a) {};
  }

  if (window.entryData === "undefined") {
    window.entryData = {};
  }

  page = 1;

  count = 10;

  $(function() {
    var grid, load_contents, tmpl;
    tmpl = _.template($('#template-item').html());
    grid = $('.timeline').get(0);
    load_contents = function() {
      return $.ajax({
        url: '/entry/search.json',
        dataType: "json",
        data: {
          count: count,
          page: page
        },
        success: function(data) {
          var i, item, _i, _j, _ref, _ref1;
          item = [];
          for (i = _i = 0, _ref = data.data.entries.length; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
            item.push(document.createElement('article'));
          }
          salvattore.append_elements(grid, item);
          for (i = _j = 0, _ref1 = data.data.entries.length - 1; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
            item[i].outerHTML = tmpl({
              stamp_num: data.data.entries[i].stamps.length,
              comment_num: data.data.entries[i].comments.length,
              fullsize_image_url: data.data.entries[i].fullsize_image_url,
              entryIndex: i + (page - 1) * count
            });
          }
          if (count > data.data.entries.length + 1) {
            $('#load-more').hide();
          }
          page++;
          if (window.entryData.entries === "undefined") {
            window.entryData.entries = [];
          }
          window.entryData.entries = window.entryData.entries.concat(data.data.entries);
          window.entryData.metadata = data.metadata;
          return window.util.showImageDetail();
        },
        error: function() {
          return window.console.log("error");
        }
      });
    };
    load_contents();
    $('#load-more').on('click', load_contents);
    return $('#image_upload').on('click', function() {
      return location.href = '/image/web/upload';
    });
  });

}).call(this);
